{% extends 'base.html' %}

{% block head %}
    <title>Ver Pagos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4 text-center">Lista de Pagos</h2>
    <a href="{{ url_for('pagos.crear_pagos') }}" class="btn btn-primary mb-3">
        <i class="fas fa-plus-circle me-2"></i>Crear Nuevo Pago
    </a>
    {% if pagos %}
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th scope="col">Fecha</th>
                    <th scope="col">Actividad</th>
                    <th scope="col">Nombre de Actividad</th>
                    <th scope="col">Costo Paquete</th>
                    <th scope="col">Cant. Personas</th>
                    <th scope="col">Tipo Cambio</th>
                    <th scope="col">Total Bruto Ind.</th>
                    <th scope="col">Total Bruto Gen. (CRC)</th>
                    <th scope="col">Total Bruto Gen. (USD)</th>
                    <th scope="col">Ganancia P.P.</th>
                    <th scope="col">Ganancia General</th>
                    <th scope="col">Nota</th>
                    <th scope="col">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for pago in pagos %}
                <tr>
                    <td>{{ pago.fecha_registro.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ pago.actividad }}</td>
                    <td>{{ pago.nombre_actividad }}</td>
                    <td>₡{{ "%.2f"|format(pago.costo_paquete) }}</td>
                    <td>{{ pago.cantidad_personas }}</td>
                    <td>{{ "%.4f"|format(pago.tipo_cambio) }}</td>
                    <td>₡{{ "%.2f"|format(pago.total_bruto_individual) }}</td>
                    <td>₡{{ "%.2f"|format(pago.total_bruto_general_colones) }}</td>
                    <td>${{ "%.2f"|format(pago.total_bruto_general_dolar) }}</td>
                    <td>₡{{ "%.2f"|format(pago.total_ganancia_pp) }}</td>
                    <td>₡{{ "%.2f"|format(pago.total_ganancia_general) }}</td>
                    <td>{{ pago.nota or 'N/A' }}</td>
                    <td>
                        <a href="{{ url_for('pagos.editar_pagos', id=pago.id) }}" class="btn btn-sm btn-warning me-2">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        <form action="{{ url_for('pagos.borrar_pagos', id=pago.id) }}" method="POST" class="d-inline" onsubmit="return confirm('¿Estás seguro de que quieres borrar este pago?');">
                            <input type="hidden" name="csrf_token" value="{{ generate_csrf() }}">
                            <button type="submit" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash-alt"></i> Borrar
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        No hay pagos registrados aún. ¡Crea uno nuevo!
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
