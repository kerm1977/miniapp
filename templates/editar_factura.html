{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Editar Factura #{{ form.numero_factura.data }}</h1>
    <form method="POST" action="{{ url_for('editar_factura', id=factura_id) }}">
        {{ form.hidden_tag() }} {# Esto incluye el token CSRF #}

        <div class="mb-3">
            {{ form.numero_factura.label(class="form-label") }}
            {{ form.numero_factura(class="form-control rounded-pill", readonly="readonly") }} {# El número de factura es de solo lectura #}
        </div>

        <div class="mb-3">
            {{ form.cliente_id.label(class="form-label") }}
            {{ form.cliente_id(class="form-select rounded-pill") }}
            {% if form.cliente_id.errors %}
                <div class="text-danger">
                    {% for error in form.cliente_id.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.fecha_emision.label(class="form-label") }}
            {{ form.fecha_emision(class="form-control rounded-pill", type="date") }}
            {% if form.fecha_emision.errors %}
                <div class="text-danger">
                    {% for error in form.fecha_emision.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.descripcion.label(class="form-label") }}
            {{ form.descripcion(class="form-control rounded-pill", rows=3) }}
            {% if form.descripcion.errors %}
                <div class="text-danger">
                    {% for error in form.descripcion.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.monto_total.label(class="form-label") }}
            {{ form.monto_total(class="form-control rounded-pill", type="number", step="0.01") }}
            {% if form.monto_total.errors %}
                <div class="text-danger">
                    {% for error in form.monto_total.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <hr>
        <h5 class="mb-3">Detalles Adicionales</h5>

        {# --- NUEVOS CAMPOS DEL FORMULARIO AQUÍ --- #}
        <div class="mb-3">
            {{ form.interes.label(class="form-label") }}
            {{ form.interes(class="form-select rounded-pill") }}
            {% if form.interes.errors %}
                <div class="text-danger">
                    {% for error in form.interes.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.realizado_por.label(class="form-label") }}
            {{ form.realizado_por(class="form-select rounded-pill") }}
            {% if form.realizado_por.errors %}
                <div class="text-danger">
                    {% for error in form.realizado_por.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.sinpe.label(class="form-label") }}
            {{ form.sinpe(class="form-select rounded-pill") }}
            {% if form.sinpe.errors %}
                <div class="text-danger">
                    {% for error in form.sinpe.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.tipo_actividad.label(class="form-label") }}
            {{ form.tipo_actividad(class="form-select rounded-pill") }}
            {% if form.tipo_actividad.errors %}
                <div class="text-danger">
                    {% for error in form.tipo_actividad.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.nombre_actividad_etapa.label(class="form-label") }}
            {{ form.nombre_actividad_etapa(class="form-control rounded-pill") }}
            {% if form.nombre_actividad_etapa.errors %}
                <div class="text-danger">
                    {% for error in form.nombre_actividad_etapa.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.costo_actividad.label(class="form-label") }}
            {{ form.costo_actividad(class="form-control rounded-pill", type="number", step="0.01") }}
            {% if form.costo_actividad.errors %}
                <div class="text-danger">
                    {% for error in form.costo_actividad.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="mb-3">
            {{ form.otras_descripcion.label(class="form-label") }}
            {{ form.otras_descripcion(class="form-control rounded-pill", rows=3) }}
            {% if form.otras_descripcion.errors %}
                <div class="text-danger">
                    {% for error in form.otras_descripcion.errors %}{{ error }}{% endfor %}
                </div>
            {% endif %}
        </div>
        {# --------------------------------------- #}

        <button type="submit" class="btn btn-primary rounded-pill mt-3">{{ form.submit.label }}</button>
        <a href="{{ url_for('ver_facturas') }}" class="btn btn-secondary rounded-pill mt-3 ms-2">Cancelar</a>
    </form>
</div>
{% endblock %}